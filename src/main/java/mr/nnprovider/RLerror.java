package mr.nnprovider;

import java.util.Iterator;

import com.github.neuralnetworks.calculation.OutputError;
import com.github.neuralnetworks.tensor.Tensor;


//TODO: set this up so that it actually  does soemthing relavent for RL
public class RLerror implements OutputError{
	 private float networkError;
	    private int size;
	    private int errorSamples;

	    @Override
	    public void addItem(Tensor networkOutput, Tensor targetOutput) {
		Iterator<Integer> targetIt = targetOutput.iterator();
		Iterator<Integer> actualIt = networkOutput.iterator();
		size += targetOutput.getDimensions()[targetOutput.getDimensions().length - 1];
		float error = 0;
		while (targetIt.hasNext() && actualIt.hasNext()) {
		    error += Math.abs(Math.abs(networkOutput.getElements()[actualIt.next()]) - Math.abs(targetOutput.getElements()[targetIt.next()]));
		}
		networkError += error;
		if (error / targetOutput.getDimensions()[targetOutput.getDimensions().length - 1] > 0.5) {
		    errorSamples += targetOutput.getDimensions()[targetOutput.getDimensions().length - 1];
		}
	    }

	    @Override
	    public float getTotalNetworkError() {
		return size > 0 ? networkError / size : 0;
	    }

	    @Override
	    public int getTotalErrorSamples() {
		return errorSamples;
	    }

	    @Override
	    public int getTotalInputSize() {
		return size;
	    }

	    @Override
	    public void reset() {
		networkError = 0;
		errorSamples = 0;
		size = 0;
	    }
	    
}
